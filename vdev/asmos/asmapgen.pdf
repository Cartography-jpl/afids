procedure
parm key string
parm pixsiz real
parm mlon real
parm mlat real

local refmap type=(string,99)
local mastername type=(string,30)
local utmzone int
local utmstring string
local uln real
local ule real
local urn real
local ure real
local lln real
local lle real

body


let mastername = "&key" // "_params"
asc2tcl &mastername keyword="refmap=" val=refmap vtype=0

!   generate the utm master image

let utmzone = $fix(mlon/6.0+31.0)
let utmstring = "326" // "&utmzone" // "(PCS_WGS84_UTM_zone_" // "&utmzone" // "N)"
let ule = ($float(utmzone)-31.0)*6.0
let ule = mlon-ule-3.0
let ule = ule*80000.0+500000.0    ! need to calibrate, but approx OK
let uln = mlat*110000.0        ! need to calibrate, but approx OK
let ure = ule + pixsiz*100.0
let urn = uln
let lle = ule
let lln = uln - pixsiz*100.0

gtgen out=&refmap 'tiecnvrt 'rectfit +
   geotiff=("ModelTiePointTag=(0,0,0,&ule,&uln,0.0)", +
     "ModelTiePointTag=(100,0,0,&ure,&urn,0.0)", +
     "ModelTiePointTag=(0,100,0,&lle,&lln,0.0)", +
     "ProjectedCSTypeGeoKey=&utmstring", +
     "GTRasterTypeGeoKey=2(RasterPixelIsPoint)")
gtlist &refmap

end-proc
