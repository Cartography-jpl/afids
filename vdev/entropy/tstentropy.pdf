procedure
local dir string
local   afidsroot   type=string count=1
local   aftestdata  type=string count=1
! Oct 10, 2019 - RJB
! TEST SCRIPT FOR ENTROPY
!
! Vicar Programs:
!       translog label-list 
!
! External programs
!   <none> 
!
! Parameters:
!   <none>
!
! Requires external test data: 
! Uses cartlab or mipl dependent pointers
!   Cartlab defines env var $AFIDS_ROOT, mipl doesn't
!   The test data in cartlab is on /raid3/test_data 
!   but in other facilities it might be somewhere else. 
!   
!   To facilitate this test you can define an
!   environment variable $AFIDS_TESTDATA to point to
!   that data. The cartlab system does not. In the git archive
!   on pistol there is softlink to the test data in vdev that
!   allows this test to pass 
!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!

refgbl $autousage
refgbl $echo
!refgbl $syschar

body

let $autousage="none"
let _onfail="goto rm"
let $echo="yes"
!check to see if mipl or cartlab for certain programs
!cartlab defines env var $AFIDS_ROOT, mipl doesm't
translog INP=AFIDS_ROOT TRANS=afidsroot
translog INP=AFIDS_TESTDATA TRANS=aftestdata
if (afidsroot = "")
!MIPL
    ush ln -s /project/test_work/testdata/gll mm
    ush ln -s /project/test_work/testdata/cassini/iss ca
else
!CARTLAB
    if (aftestdata = "")
        ush ln -s ../test_data/gll  mm 
        ush ln -s ../test_data/cassini/iss  ca
    else
        ush ln -s /media/sf_raid3/test_data/gll mm
        ush ln -s /media/sf_raid3/test_data/cassini/iss ca
    end-if
end-if

let $echo="no"
write "Generic Image Test"
write ""
write "test image 1 - entropy should be 0"
let $echo="yes"
gen a.img 16 16
entropy a.img

let $echo="no"
write "test image 2 - entropy should be 1.0"
let $echo="yes"
gen b.img 16 16 mod=2
entropy b.img

let $echo="no"
write "test image 3 (byte) - entropy should be 0.811278"
let $echo="yes"
gen c.img 16 16 mod=4
entropy c.img 

let $echo="no"
write "test image 4 (half) - entropy should be 0.811278,"
write "local variable ent should be filled by that value"
let $echo="yes"
local out_ent real
cform c.img d.img  'half
entropy d.img value=out_ent
disp out_ent

let $echo="no"
write ""
write ""
write "GALILEO Test"
write ""
write "Testing AREA parameter"
let $echo="yes"
entropy mm/s0349666345.u area=(1,1,100,100)

let $echo="no"
write ""
write ">>> NOTE TESTERS <<<"
write "Testing PHIST keyword to generate normalized difference histogram"
write "The Histogram generated by the PHIST keyword has data range from "
write "-4095 to 4095, which would be too large to capture in a session log "
write "file.  The Tester is suggested to execute the following case to test "
write "the PHIST keyword."
write "-- RUN THE FOLLOWING --"
write "UNIX: VICAR>entropy /project/test_work/testdata/mipl/gll/s0249220600.1 +"
write "      VICAR>+ 'phist"
let $echo="yes"

let $echo="no"
write ""
write ">>> NOTE TESTERS <<<"
write "Testing ZEROES keyword"
write "-- RUN THE FOLLOWING --"
write "UNIX: VICAR>entropy /project/test_work/testdata/mipl/gll/s0249220600.1 +"
write "      VICAR>+ 'phist 'zeroes"
let $echo="yes"

let $echo="no"
write ""
write "Testing DISTFILE parameter to generate difference histogram file"
let $echo="yes"
entropy mm/s0349632122.1 distfile=gll.dist

let $echo="no"
write ""
write "Testing VALUE parameter"
!entropy mm/s0349758952.18 value=out_ent
entropy mm/s0349674146.1 value=out_ent
disp out_ent

let $echo="no"
write ""
write "Testing MODE parameter.  GLL label should not be updated."
let $echo="yes"
copy mm/s0349759013.r s0349759013.r
label-list s0349759013.r
entropy s0349759013.r 'label
label-list s0349759013.r

let $echo="no"
write ""
write ""
write "CASSINI Test"
write "Testing AREA parameter"
let $echo="yes"
entropy ca/sum2.15 area=(1,1,100,100)
 
let $echo="no"
write ""
write ">>> NOTE TO TESTERS <<<"
write "Testing PHIST keyword to generate normalized difference histogram"
write "--- RUN THE FOLLOWING ---"
write "UNIX: VICAR>entropy /project/test_work/testdata/cassini/iss/sum2.1 +"
write "      VICAR>+ 'phist"
let $echo="yes"
 
let $echo="no"
write ""
write ">>> NOTE TO TESTERS <<<"
write "Testing ZEROES keyword"
write "--- RUN THE FOLLOWING ---"
write "UNIX: VICAR>entropy /project/test_work/testdata/cassini/iss/sum2.2 +"
write "      VICAR>+ 'phist 'zeroes"
let $echo="yes"
 
let $echo="no"
write ""
write "Testing DISTFILE parameter to generate difference histogram file"
let $echo="yes"
entropy ca/sum2.3 distfile=cassini.dist

let $echo="no"
write ""
write "Testing VALUE parameter"
entropy ca/sum2.7 value=out_ent
disp out_ent
 
let $echo="no"
write ""
write "Testing MODE parameter.  History label should be updated."
let $echo="yes"
copy ca/sum2.38 sum2.38
label-list sum2.38
entropy sum2.38 'label
label-list sum2.38

let $echo="no"
rm>
ush rm mm
ush rm ca 
end-proc

