procedure
refgbl $echo
refgbl $autousage

local l1 real
local s1 real
local l2 real
local s2 real
local l3 real
local s3 real
local l4 real
local s4 real

local sl int
local ss int
local nl int
local ns int

local   afidsroot   type=string count=1
local   aftestdata  type=string count=1

body
let $autousage="none"

let $echo="yes"

!check to see if mipl or cartlab for test images
!cartlab defines env var $AFIDS_ROOT, mipl doesm't
let _onfail="stop"
translog INP=AFIDS_ROOT TRANS=afidsroot
translog INP=AFIDS_TESTDATA TRANS=aftestdata
if (afidsroot = "")
!MIPL
    ush ln -s /project/test_work/testdata/carto ct
else
!CARTLAB
    if (aftestdata = "")
        ush ln -s /raid1/vicar_test_images/testdata/carto ct
    else 
        ush ln -s $AFIDS_TESTDATA/vicar_test_images/testdata/carto ct
    end-if
end-if
let _onfail="goto rm"

!  simple case

gen xxxim0 nl=10 ns=10
f2 inp=xxxim0 out=xxxim1 +
    func="(abs(line-5.5)<3)*(abs(samp-5.5)<3)"
list xxxim1 'zer

imcorner xxxim1 line1=l1 samp1=s1 line2=l2 samp2=s2 +
                line3=l3 samp3=s3 line4=l4 samp4=s4 inside=1 +
                sldat=sl ssdat=ss nldat=nl nsdat=ns
                
write "c1 &l1 &s1"
write "c2 &l2 &s2"
write "c3 &l3 &s3"
write "c4 &l4 &s4"
write "sl,ss &sl &ss"
write "nl,ns &nl &ns"

gen xxxim0 nl=10 ns=10
f2 inp=xxxim0 out=xxxim1 +
    func="(abs(line-5.5)<3)*(abs(samp-5.5)<3)"
list xxxim1 'zer

imcorner xxxim1 line1=l1 samp1=s1 line2=l2 samp2=s2 +
                line3=l3 samp3=s3 line4=l4 samp4=s4
                
write "l1,s1 &l1 &s1"
write "l2,s2 &l2 &s2"
write "l3,s3 &l3 &s3"
write "l4,s4 &l4 &s4"

!  two input case

gen xxxim0 nl=10 ns=10
f2 inp=xxxim0 out=xxxim1 +
    func="(abs(line-5.5)<3)*(abs(samp-5.5)<3)"
gtgen inp=xxxim1 'tiecnvrt +
   geotiff=("ModelTiePointTag=(0,0,0,.3,.3,0.0)", +
          "ModelTiePointTag=(10,0,0,.5,.3,0.0)", +
          "ModelTiePointTag=(0,10,0,.3,.5,0.0)", +
          "ProjectionGeoKey=20(CT_MillerCylindrical)", +
          "GTRasterTypeGeoKey=2(RasterPixelIsPoint)", +
          "GeogEllipsoidGeoKey=7030(Ellipse_WGS84)")

gtcopy xxxim1 xxxim2 size=(2,2,10,10)
f2 inp=xxxim2 out=xxxim3 +
    func="(abs(line-5.5)<3)*(abs(samp-5.5)<3)"
    
!gtoffset xxxim1 xxxim3
list xxxim1 'zer
list xxxim3 'zer
    
imcorner (xxxim1,xxxim3) line1=l1 samp1=s1 line2=l2 samp2=s2 +
                line3=l3 samp3=s3 line4=l4 samp4=s4
write "c1 &l1 &s1"
write "c2 &l2 &s2"
write "c3 &l3 &s3"
write "c4 &l4 &s4"

! the correlation footprint case

gen xxxim0 nl=10 ns=10
f2 inp=xxxim0 out=xxxim1 +
    func="(abs(line-5.5)<3)*(abs(samp-5.5)<3)*((samp<7)+(line>4))"
list xxxim1 'zer

imcorner xxxim1 line1=l1 samp1=s1 line2=l2 samp2=s2 +
                line3=l3 samp3=s3 line4=l4 samp4=s4 inside=0 +
                sldat=sl ssdat=ss nldat=nl nsdat=ns 'corrfoot
                
write "c1 &l1 &s1"
write "c2 &l2 &s2"
write "c3 &l3 &s3"
write "c4 &l4 &s4"
write "sl,ss &sl &ss"
write "nl,ns &nl &ns"

imcorner ct/20140826_Day_eco6_mb49_mosaic.hlf line1=l1 +
   samp1=s1 line2=l2 samp2=s2 line3=l3 samp3=s3 line4=l4 samp4=s4 +
   inside=256

write "l1 &l1"
write "s1 &s1"
write "l2 &l2"
write "s2 &s2"
write "l3 &l3"
write "s3 &s3"
write "l4 &l4"
write "s4 &s4"

rm>
let $echo="no"
ush rm ct
theend>
END-PROC
