procedure
parm inp type=(string,99)
parm altfile2 type=(string,99) count=0:1 default=""
parm nostrtch string valid=("n","y") default="n"

local file2 type=(string,99)
local temp1 type=(string,99)
local temp2 type=(string,99)
local temp3 type=(string,99)
local fmt string
local fmtbase string
body

! utility to display image vs. base or master

if (altfile2="")
   plab2tcl &inp property=COREG_META_DATA val=file2 +
      keyword=ACCREF vtype=0
else
   let file2 = "&altfile2"
end-if

let temp1 = "&inp" // ".rev1"
let temp2 = "&inp" // ".rev2"
let temp3 = "&inp" // ".rev3"

lab2tcl &inp v1=fmt keyword=format 'system
lab2tcl &file2 v1=fmtbase keyword=format 'system
if (fmt=fmtbase)
   gtcopy &inp +
     &temp1
else
   f2 &inp +
     &temp1 +
     fun="in1*0.022" format=&fmtbase
end-if

stretch inp=&temp1 +
  out=&temp2 +
  'gauss

gtwarp &file2 +
  &temp1 +
  ref=&temp2 +
  'coverref  nah=400 nav=400

if (nostrtch="n")
   stretch inp=&temp1 +
     out=&temp3 +
     'gauss
   xvd (&temp3, +
       &temp2, +
       &temp2)
else
   xvd (&temp1, +
       &temp2, +
       &temp2)
end-if

! cleanup doesn't work, xvd asynch

!gtcopy &temp3 +
!  &temp1 nl=1 ns=1
!gtcopy &temp2 +
!  &temp1

end-proc
