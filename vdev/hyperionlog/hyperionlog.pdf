process help=*
parm inp      type=(string,99)
parm acs      type=(string,99) default=""
parm acorn    type=(string,99) default=""
parm out      type=(string,99) default=""

parm sl       type=int  default=0
parm ss       type=int  default=0
parm nl       type=int  default=100000
parm ns       type=int  default=100000

parm sb       type=int  default=28
parm nbnd     type=int  default=7

parm vg	      type=real default=1.0
parm sg       type=real default=1.0

parm doImg     type=int         default=1
parm echoMeta  type=int         default=0

end-proc
.title
VICAR Program hyperionlog - logs HYPERION data sets to VICAR/IBIS
.help
PURPOSE

     HYPERIONLOG logs an optionally user-specified sub-area of an
     HYPERION archive file to VICAR/IBIS.

.PAGE
TAE COMMAND LINE FORMAT

     hyperionlog INP=A ACS=B ACORN=C OUT=D PARMS
     
     where

     A is the input Hyperion file name.
     B is the input associated ACS file name.
     C is the input Acorned headerless BIL image derived from A
     D is the output file name prefix. If no output prefix
         is provided, one is autogenerated with the form:
         EO1_HYPERION_YYYYMMDD_HHMM

         The output meta datafile has the form prefix.txt.
         Other output files have the form prefix_band(s).ext where ext is
         img  for a generated VICAR file
         raw  for a 16-bit raw BIL file used by ACORN
         cal  for another ACORN file
         gain for another ACORN file
         off  for another ACORN file

     PARMS
       sl start line (one based value with (1,1) pixel in nw corner
       ss start sample (one based value)
       nl number of lines to extract
       ns number of samples to extract
       sb is the start band (range 1-242)
       nbnd is the number of bands to extract
       vg is an optional VNIR gain multiplier
       sg is an optioal SWIR gain multiplier
       doimg is a flag indicating whether to actually produce an image
       echoMeta is a flag indicating whether to echo the metadata to stdout
         via zifmessage

.PAGE
OPERATION

   HYPERIONLOG logs a user-specified sub-area of an HYPERION data set
   archive file to VICAR.

   The ACS HDF file is the attitude control system file and contains 
   platform quaternions and nadir lat/lon as a function of seconds 
   since 00:00:00 UTC, January 1, 1970. Other parameters in the ACS 
   file are used to compute the sensor look angle. The L1R HDF image 
   file contains the start time. Given a fixed frame rate (223.4 Hz)
   and the number of image lines, the stop time can be computed. The
   start and stop times are used to interpolate the nadir position
   and look angle for the first and last image lines. The sensor 
   altitude is advertised to be 705 km.

   The meta data file contains several values about the source
   files, Hyperion specific data, the logging event, and the
   output files.

   Hyperion HDF files contain 242 image bands (interleaved) with
   signed 16-bit pixels. Typical image size is 256 samples by 6925
   lines.

   Pixel geolocation is supported by exporting, for the first and last
   image lines, the platform nadir location, and the sensor look angle.
   The computed look angle includes the platform roll and the angle 
   between the platform and the sensor boresight.

.PAGE
     
RESTRICTIONS

   Input files must conform to EO-1/Hyperion Science Data User's
   Guide, May 2001, TRW Doc No. HYP.TO.01.077, CAGE No. 11982.

.PAGE
COGNIZANT PROGRAMMER:  W. L. Bunch
WRITTEN BY:            W. L. Bunch

REVISIONS: 
  Fri Dec 28 2007 wlb switched to USES_ANSI_C AND LIB_CARTO; misc cleanup

  Fri Mar 25 2005
    Ported to linux.

  Wed Apr  9 2003
    Added option to use Acorned image

  Wed Nov 06 2002
    Misc cleanup

  Mon Oct 21 2002
    Initial version

.level1
.var inp
HYPERION data set image and acs file names
.var out
The output file prefix
.var sl
Starting line of sub-area.
.var ss
Starting sample of sub-area.
.var nl
Number of lines of sub-area.
.var ns
Number of samples of sub-area.
.level2
.var sl
Starting line of sub-area within HYPERION archive data set. This is a
one-based value.
.var ss
Starting sample of sub-area within HYPERION archive data set. This is a
one-based value.
.var nl
Number of lines to extract from the HYPERION archive data set.
.var ns
Number of samples to extract from HYPERION archive data set.
.end
