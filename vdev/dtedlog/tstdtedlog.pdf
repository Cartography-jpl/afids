procedure
local   afidsroot   type=string count=1
local   aftestdata  type=string count=1

! Sep 01, 2013 - RJB
! TEST SCRIPT FOR DTEDLOG
!
! Vicar Programs:
!   translog label-list list gtlist
!
! Parameters:
!   version: ibis-1, ibis-2
!   org: column, row
!
! Requires external test data: 
!   cartlab or mipl dependent pointers
!
!   Cartlab defines env var $AFIDS_ROOT, mipl doesn't
!   The test data in cartlab is on /raid1/test_data 
!   but in other facilities it might be somewhere else. 
!   
!   To facilitate this test you can define an
!   environment variable $AFIDS_TESTDATA to point to
!   that data. The cartlab system does not. In the git archive
!   on pistol there is softlink to the test data in vdev that
!   allows this test to pass 
!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!

refgbl $echo
refgbl $autousage
refgbl $syschar
body
let $autousage = "none"
let _onfail="stop"
let $echo="no"
!check to see if mipl or cartlab for test images
!cartlab defines env var $AFIDS_ROOT, mipl doesm't
translog INP=AFIDS_ROOT TRANS=afidsroot
translog INP=AFIDS_TESTDATA TRANS=aftestdata
if (afidsroot = "")
!MIPL
    write "******************************************"
    write "MIPL does not have the required test data"
    write "******************************************"
    goto theend
else
!CARTLAB
    if (aftestdata = "")
        ush ln -s /raid3/test_data/dted1 dt1
        ush ln -s /raid3/test_data dt2
    else
        ush ln -s $AFIDS_TESTDATA/dted1 dt1
        ush ln -s $AFIDS_TESTDATA dt2
    end-if
end-if
let _onfail="goto rm"

write "**********************************"
write " TEST 1 - Level 2 Data missing"
write "**********************************"

let $echo="yes"
 
! TEST SCRIPT FOR DTEDLOG

dtedlog /export/data1/srtm2/caseK1arcsec/n44e134.02.dt2 out=xxx +
    lon=134 lat=44 level=2

label-list xxx
list xxx nl=3 ns=3 
list xxx nl=3 ns=3 ss=3599
list xxx nl=3 ns=3 sl=3599
list xxx nl=3 ns=3 sl=3599 ss=3599
gtlist xxx

let $echo="no"
write "**********************************"
write " TEST 2 - Level2 Data Present"
write "**********************************"
let $echo="yes"

dtedlog dt2/n33e130.02.dt2 out=www +
    lon=130 lat=33 level=2

label-list www
list www nl=3 ns=3
list www nl=3 ns=3 ss=3599
list www nl=3 ns=3 sl=3599
list www nl=3 ns=3 sl=3599 ss=3599
gtlist www



let $echo="no"
write "**********************************"
write " TEST 3 - Level 1 Data Missing "
write "**********************************"
let $echo="yes"
!  level 1 case

dtedlog /export/data1/dted1/e129/n41.dt1 out=yyy lon=129 lat=41

label-list yyy
list yyy nl=3 ns=3 
list yyy nl=3 ns=3 ss=1199
list yyy nl=3 ns=3 sl=1199
list yyy nl=3 ns=3 sl=1199 ss=1199
gtlist yyy
let $echo="no"
write "**********************************"
write " TEST 4 - Level 1 Data Present"
write "**********************************"
let $echo="yes"

dtedlog dt1/e045/n40.dt1 out=zzz lon=45 lat=40

label-list zzz
list zzz nl=3 ns=3
list zzz nl=3 ns=3 ss=1199
list zzz nl=3 ns=3 sl=1199
list zzz nl=3 ns=3 sl=1199 ss=1199
gtlist zzz

rm>
let $echo="no"
ush rm dt1
ush rm dt2
theend>

end-proc
