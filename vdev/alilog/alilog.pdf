process help=*
parm inpre    type=(string,99)
parm acs      type=(string,99) default=""
parm outpre   type=(string,99) default=""

parm sl       type=int  default=0
parm ss       type=int  default=0
parm nl       type=int  default=100000
parm ns       type=int  default=100000

parm sb       type=int  default=1
parm nbnd     type=int  default=1
parm pan      type=keyword count=(0:1) valid=pan default=--

parm noImg     type=keyword count=(0:1) valid=noImg default=--
parm echoMeta  type=keyword count=(0:1) valid=echoMeta default=--

end-proc
.title
VICAR Program alilog - logs ALI data sets to VICAR/IBIS
.help
PURPOSE

     ALILOG logs an optionally user-specified sub-area of an
     ALI archive file to VICAR/IBIS.

.PAGE
TAE COMMAND LINE FORMAT

     alilog INPRE=A ACS=B OUTPRE=C PARMS
     
     where

     A is the input ALI file name prefix, e.g. EO1A0390322004135110PY
     B is the input associated ACS file name, e.g. 2004_135_acs.hdf
     C is the output file name prefix. If no output prefix
         is provided, one is autogenerated with the form:
         EO1_ALI_MS_YYYYMMDD_HHMM for the multi-spectral sensor, or 
         EO1_ALI_PN_YYYYMMDD_HHMM for the panchromatic sensor.

         The output meta datafile has the form outputPrefix.txt.
         Other output files have the form outputPrefix_band(s)_Sn.ext where n is
         a strip number (range 1 to 4) and ext is img for a generated VICAR file.

     PARMS
       sl start line (one based value with (1,1) pixel in nw corner
       ss start sample (one based value)
       nl number of lines to extract
       ns number of samples to extract

       sb is the start band (range 1-9) (for multi-spectral)
       nbnd is the number of bands to average for single output image
       pan causes logging of the panchromatic band; sb, nb are forced to 1

       noImg is a flag indicating that image extraction should be suppressed
       echoMeta is a flag indicating whether to echo the metadata to stdout
         via zifmessage

.PAGE
OPERATION

   ALILOG logs a user-specified sub-area of an ALI data set
   archive file to VICAR.

   The ACS HDF file is the attitude control system file and contains 
   platform quaternions and nadir lat/lon as a function of seconds 
   since 00:00:00 UTC, January 1, 1970. Other parameters in the ACS 
   file are used to compute the sensor look angle. The L1R HDF image 
   file contains the start time. Given a fixed frame rate (223.4 Hz)
   and the number of image lines, the stop time can be computed. The
   start and stop times are used to interpolate the nadir position
   and look angle for the first and last image lines. The sensor 
   altitude is advertised to be 705 km.

   The meta data file contains several values about the source
   files, ALI specific data, the logging event, and the
   output files.

   Hyperion HDF files contain 9 multi-spectral and one panchromatic
   image bands (multi-spectral interleaved) with
   signed 16-bit pixels. Typical MS image size is 256 samples by 6925
   lines. Typical PAN image size is 960 samples by 9409 lines.

   Pixel geolocation is supported by exporting, for the first and last
   image lines, the platform nadir location, and the sensor look angle.
   The computed look angle includes the platform roll and the angle 
   between the platform and the sensor boresight.

   The input HDF image datasets are expected to come in four strip files,
   named prefix.M1R through prefix.M4R.

.PAGE
     
RESTRICTIONS

   Input files must conform to EO-1/Hyperion Science Data User's
   Guide, May 2001, TRW Doc No. HYP.TO.01.077, CAGE No. 11982.

.PAGE
COGNIZANT PROGRAMMER:  W. L. Bunch
WRITTEN BY:            W. L. Bunch

REVISIONS: 
  Tue Aug  3 2004    Initial version
  Fri Mar 25 2005    Ported to linux.
Thu Jan  3 2008 wlb switched to USES_ANSI_C AND LIB_CARTO; misc cleanup  

.level1
.var inpre
ALI data set image and acs file names
.var acs
The ACS HDF file associated with the ALI HDF strip files
.var outpre
The output file prefix
.var sl
Starting line of sub-area
.var ss
Starting sample of sub-area
.var nl
Number of lines of sub-area
.var ns
Number of samples of sub-area
.var sb
Start band (for multi spectral) range 1 to 9
.var nbnd
Number of bands (for multi spectral) range 1 to 9
.var pan
Keyword option requesting logging of single panchromatic image
.var noImg
Keyword option supressing creation of image
.var echoMeta
Keyword option echoing metadata to terminal
.level2
.var sl
Starting line of sub-area within ALI archive data set. This is a
one-based value.
.var ss
Starting sample of sub-area within ALI archive data set. This is a
one-based value.
.var nl
Number of lines to extract from the ALI archive data set.
.var ns
Number of samples to extract from ALI archive data set.
.end
